<?= $this->doctype(); ?><html>
    <head>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
        <?= $this->headTitle(); ?>
        <?= $this->headMeta(); ?>
        <?= $this->headLink(); ?>

    </head>

    <body>
<div id="fb-root"></div>
<script src="http://connect.facebook.net/en_US/all.js">
</script>
<script>
     FB.init({
        appId:'209056955830996', cookie:true,
        status:true, xfbml:true
     });

    // Call this from firebug:
    // login('1625795908', 'Diogo Melo', 'melo@vonbraunlabs.com.br',
    // 'kljkjkj');
    function login(facebook_id, name, email, url) {
        $.get('/user/login', {
            facebook_id: facebook_id,
            name: name,
            email: email,
            url: url
        }, function(data) {
            loadPlaylist();
        });
    }

    function processLogin() {
        FB.api('/me', function(user) {
            var userDiv = $('#user');
            var loginDiv = $('#login-button');
            if(user != null && user.id != null) {
                var image = document.getElementById('image');
                image.src = 'http://graph.facebook.com/' + user.id + '/picture';
                var name = document.getElementById('name');
                name.innerHTML = user.name;
                userDiv.css('visibility', 'visible');
                loginDiv.css('visibility', 'hidden');

                login(user.id, user.first_name + " " + user.last_name, user.email, user.link);
            }
            else {
                userDiv.css('visibility', 'hidden');
                loginDiv.css('visibility', 'visible');
            }
        });
    }

    processLogin();


</script>

<div class="topbar">
    <div class="topbar-inner">
        <div class="container">
            <a class="brand" href="#">Amuzi</a>
            <ul class="nav">
                <li><a href="/playlist" class="loadModal" title="Playlist Manager"><?= $this->t('Playlist'); ?></a></li>
                <li><a href="/user" class="loadModal" title="User Settings"><?= $this->t('Settings'); ?></a></li>
                <li><a href="/index/about" class="loadModal" title="About Amuzi"><?= $this->t('About'); ?></a></li>
            </ul>
            <div class="pull-right">
                <fb:login-button id="login-button" scope="email,user_checkins" style="visibility: hidden" OnLogin="processLogin();" style="">
                    <?= $this->t('Login with Facebook'); ?>
                </fb:login-button>
            </div>

        </div>
    </div>
</div>


<div id="wrapper" class="container">

    <div id="logo">
        <h1><a href="#">amuzi</a></h1>
        <h2><a href="#"><?= $this->t('amazingly free'); ?></a></h2>
    </div>

    <div class="alert-message" data-alert="true">
        <a href="#" class="close">x</a>
        <p>#</p>
    </div>

    <div id="user" style="visibility: hidden">
        <img id="image"/>
        <div id="name"></div>
    </div>






    <section id="content">
        <?= $this->layout()->content; ?>
    </section>

</div>

<footer class="footer">
    <div class="container">
        <p id="legal">Copyright &copy; 2011 <a href="http://diogomelo.net">Diogo Oliveira de Melo</a>.</p>;
    </div>
</footer>
<!-- end div#footer -->

        <?= $this->headScript(); ?>

    </body>

</html>
