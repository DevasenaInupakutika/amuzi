<?= $this->doctype(); ?><html>
    <head>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
        <?= $this->headTitle(); ?>
        <?= $this->headMeta(); ?>
        <?= $this->headLink(); ?>

    </head>

    <body>
<div id="fb-root"></div>
<script src="http://connect.facebook.net/en_US/all.js">
</script>
<script>
     FB.init({
        appId:'209056955830996', cookie:true,
        status:true, xfbml:true
     });

    // Call this from firebug:
    // login('1625795908', 'Diogo Melo', 'melo@vonbraunlabs.com.br', 'kljkjkj');
    function login(facebook_id, name, email, url) {
        $.get('/user/login', {
            facebook_id: facebook_id,
            name: name,
            email: email,
            url: url
        }, function(data) {
            callbackLogin(data);
        });
    }

    function processLogin() {
        FB.api('/me', function(user) {
            var userDiv = $('#user');
            var loginDiv = $('#login-button');
            if(user != null && user.id != null) {
                var image = document.getElementById('image');
                image.src = 'http://graph.facebook.com/' + user.id + '/picture';
                var name = document.getElementById('name');
                name.innerHTML = user.name;
                userDiv.css('visibility', 'visible');
                loginDiv.css('visibility', 'hidden');

                login(user.id, user.first_name + " " + user.last_name, user.email, user.link);
            }
            else {
                userDiv.css('visibility', 'hidden');
                loginDiv.css('visibility', 'visible');
            }
        });
    }

    processLogin();


</script>

<div class="navbar navbar-fixed-top">
    <div class="navbar-inner">
        <div class="container">
            <a class="brand" href="#">Amuzi</a>
            <ul class="nav">;
                <li class="dropdown">
                    <a href="#" class="loginRequired dropdown-toggle" data-toggle="dropdown" title="Playlist Manager"><?= $this->t('Playlist'); ?> <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        <li><a href="/playlist/new" class="loadModal loginRequired noForm" name="newPlaylist" title="<?= $this->t('New Playlist'); ?>"><?= $this->t('New'); ?></a></li>
                        <li><a href="/playlist" class="loadModal loginRequired noForm" name="playlist" title="<?= $this->t('Search Playlist'); ?>"><?= $this->t('Search'); ?></a></li>
                    </ul>
                </li>
                <li><a href="/user" class="loadModal loginRequired" title="User Settings"><?= $this->t('Settings'); ?></a></li>
                <li><a href="/docs" title="Docs" target="_blank"><?= $this->t("Docs"); ?></a></li>
                <li style="margin-top: -18px"><a href="/index/about" class="loadModal" title="About Amuzi"><?= $this->t('About'); ?></a></li> <!-- the style here is a dirty fix... TODO: find the real solution -->
            </ul>
            <div class="pull-right">
                <fb:login-button id="login-button" scope="email,user_checkins" style="visibility: hidden" OnLogin="processLogin();" style="">
                    <?= $this->t('Login with Facebook'); ?>
                </fb:login-button>
            </div>
        </div>
    </div>
</div>

<!-- Github badge -->
  <div class="ribbon">
    <a href="https://github.com/dmelo/amuzi" target="_blank">Fork me on GitHub</a>
  </div>

<div id="wrapper" class="container">

    <div id="logo">
        <h1><a href="#">amuzi</a></h1>
        <h2><a href="#"><?= $this->t('amazingly free'); ?></a></h2>
    </div>

    <div class="alert visibility" data-alert="true">
        <a href="#" class="close">&times;</a>
        <p>#</p>
    </div>

    <div id="domain" style="display:none"><?= Zend_Registry::get('domain'); ?></div>

    <div id="user" style="visibility: hidden">
        <img id="image"/>
        <div id="name"></div>
    </div>






    <section id="content">
        <?= $this->layout()->content; ?>
    </section>

</div>

<footer class="footer">
    <div class="container">
        <p id="legal">Copyright &copy; 2011-<?= date('Y'); ?> <a target="_blank" href="http://diogomelo.net">Diogo Oliveira de Melo</a>.</p>
    </div>
</footer>
<!-- end div#footer -->

        <?= $this->headScript(); ?>

    </body>

</html>
